<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Route Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
      #map { height: 520px; }
      body { font-family: Arial, sans-serif; margin: 20px; }
    </style>
  </head>
  <body>
    <h2>Route result</h2>
    <p><strong>Algorithm:</strong> {{ algorithm }} &nbsp; <strong>From:</strong> {{ source }} &nbsp; <strong>To:</strong> {{ destination }}</p>
    {% if path %}
      <p><strong>Path:</strong> {{ path|join(' -> ') }}</p>
      <p><strong>Total distance (approx km):</strong> {{ '%.3f'|format(total) }}</p>
    {% else %}
      <p>No path found.</p>
    {% endif %}
    <div id="map"></div>
    <p><a href="{{ url_for('index') }}">Back</a></p>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      const cities = {{ cities|tojson }};
      const coords = {{ coords|safe }};
      const map = L.map('map').setView([28.61,77.20], 11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
      }).addTo(map);
      for (const c of cities) {
        if (c.lat && c.lon) {
          L.marker([c.lat, c.lon]).addTo(map).bindPopup(c.id + ' - ' + c.name);
        }
      }
      if (coords && coords.length > 0) {
        const latlngs = coords.map(p => [p[0], p[1]]);
        const poly = L.polyline(latlngs, {color: 'red'}).addTo(map);
        map.fitBounds(poly.getBounds(), {padding: [30,30]});
      }
    </script>
  </body>
</html>